<%layout("layouts/boilerplate.ejs")%>

<body>
<div class="container my-5 bg-light p-4">
<% if (error && error.length > 0) { %>
<div class="alert alert-danger alert-dismissible fade show" role="alert">
<%= error %>
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<% } %>

<% if (success && success.length > 0) { %>
<div class="alert alert-success alert-dismissible fade show" role="alert">
<%= success %>
<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<% } %>

<div class="text-center mb-4">
    <h1 class="display-4 fw-bold text-dark"> The Law Made For You </h1>
    <p class="mt-2 fs-5 text-secondary"> Want to review and provide feedback on proposed laws.</p>
</div>

<div class="card shadow-sm p-3 mb-4 text-center section-card">
    <h3 class="fs-5 fw-bold text-secondary mb-2">Poll Status</h3>
    <div class="d-flex justify-content-center align-items-center mb-3">
        <span class="fw-bold me-2">Current Status:</span>
        <% if (law.status === 'On-going') { %>
            <i class="fas fa-spinner text-info fa-spin me-2"></i>
            <span class="text-info fw-bold">On-going</span>
        <% } else if (law.status === 'Closed') { %>
            <i class="fas fa-check-circle text-success me-2"></i>
            <span class="text-success fw-bold">Closed</span>
        <% } else { %>
            <i class="fas fa-question-circle text-secondary me-2"></i>
            <span class="text-secondary fw-bold">Unknown</span>
        <% } %>
    </div>
    <div class="d-flex justify-content-center gap-4">
        <p class="mb-0 fs-6 text-muted"><strong>Starts:</strong> <%= law.createdAt.toLocaleDateString() %></p>
        <p class="mb-0 fs-6 text-muted"><strong>Ends:</strong> <%= law.endTime.toLocaleDateString() %></p>
    </div>
</div>

<div class="card shadow-sm p-4 mb-4 section-card">
    <h2 class="fs-4 fw-bold text-secondary mb-3">Proposed Law: <%=law.title%></h2>
    <div class="mb-3 text-muted">
        <p><strong>Proposed by:</strong> <%=law.proposedBy%></p>
        <p><strong>Main Field:</strong> <%=law.mainField%></p>
        <p><strong>Related Classes:</strong> <%=law.relatedClasses%></p>
    </div>
    <p class="text-muted lh-base"><strong>Description:</strong>
    <%=law.description%></p>
</div>

<div class="d-flex justify-content-end gap-2">
    <a href="/review/<%=law._id%>" class="btn btn-outline-primary">Review</a>

    <% if (currentUser && currentUser.isAdmin) { %>
        <% if (law.status === 'Closed') { %>
            <form action="/law/<%=law._id%>/generate-report" method="post" class="d-flex">
                <button type="submit" class="btn btn-primary">Generate Report</button>
            </form>
        <% } %>
        <a href="/law/<%=law._id%>/edit" class="btn btn-outline-secondary">Edit</a>
    <% } %>
    <a href="/list" class="btn btn-secondary">Back</a>
</div>

<% if (law.analysisResults && law.analysisResults.overallReviewCount > 0) { %>
<div class="card shadow-sm p-4 mt-4 section-card">
    <h2 class="fs-4 fw-bold text-secondary mb-3">Analysis Report</h2>
    <p><strong>Total Reviews:</strong> <%= law.analysisResults.overallReviewCount %></p>
    <p><strong>Overall Sentiment:</strong> <%= law.analysisResults.overallSentiment %></p>
    
    <div class="row mt-4">
        <div class="col-md-6 mb-4 d-flex flex-column align-items-center">
            <h3 class="fs-5 fw-bold text-center">Overall Sentiment Distribution</h3>
            <% if (law.analysisResults.overallChart) { %>
                <img src="data:image/png;base64,<%= law.analysisResults.overallChart %>" alt="Overall Sentiment Pie Chart" class="img-fluid" style="max-height: 400px;">
            <% } else { %>
                <p class="text-muted">No overall sentiment chart available.</p>
            <% } %>
        </div>
        <div class="col-md-6 mb-4 d-flex flex-column align-items-center">
            <h3 class="fs-5 fw-bold text-center">Reviews by Profession</h3>
            <% if (law.analysisResults.professionChart) { %>
                <img src="data:image/png;base64,<%= law.analysisResults.professionChart %>" alt="Reviews by Profession" class="img-fluid" style="max-height: 400px;">
            <% } else { %>
                <p class="text-muted">No profession chart available.</p>
            <% } %>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6 mb-4 d-flex flex-column align-items-center">
            <h3 class="fs-5 fw-bold text-center">Reviews by Age Group</h3>
            <% if (law.analysisResults.ageChart) { %>
                <img src="data:image/png;base64,<%= law.analysisResults.ageChart %>" alt="Reviews by Age Group" class="img-fluid">
            <% } else { %>
                <p class="text-muted">No age group chart available.</p>
            <% } %>
        </div>
        <div class="col-md-6 mb-4 d-flex flex-column align-items-center">
            <h3 class="fs-5 fw-bold text-center">Reviews by Gender</h3>
            <% if (law.analysisResults.genderChart) { %>
                <img src="data:image/png;base64,<%= law.analysisResults.genderChart %>" alt="Reviews by Gender" class="img-fluid">
            <% } else { %>
                <p class="text-muted">No gender chart available.</p>
            <% } %>
        </div>
    </div>
</div>
<% } %>

</div>
</body>